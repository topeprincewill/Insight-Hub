#!/usr/bin/env node
(()=>{var or=Object.create;var le=Object.defineProperty;var nr=Object.getOwnPropertyDescriptor;var sr=Object.getOwnPropertyNames;var ar=Object.getPrototypeOf,ir=Object.prototype.hasOwnProperty;var s=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var cr=(e,t)=>{for(var r in t)le(e,r,{get:t[r],enumerable:!0})},lr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of sr(t))!ir.call(e,o)&&o!==r&&le(e,o,{get:()=>t[o],enumerable:!(n=nr(t,o))||n.enumerable});return e};var l=(e,t,r)=>(r=e!=null?or(ar(e)):{},lr(t||!e||!e.__esModule?le(r,"default",{value:e,enumerable:!0}):r,e));var Qt=s("commander"),er=l(s("figlet"));var Le=l(s("react")),ze=s("ink");var D=s("fs-extra"),me=l(s("execa")),Re=l(s("globby")),pe=l(s("path")),Se=l(s("preferred-pm"));var Ne=l(s("ora")),pr=async(e,t)=>{let r=(0,Ne.default)({color:"cyan",text:t}).start(),n=await e();return r.stop(),n},W=pr;var de=()=>{if(!(0,D.existsSync)("package.json"))throw new Error("./package.json not found");return JSON.parse((0,D.readFileSync)("package.json","utf8"))},G=()=>{let e=de();return Object.keys(e.dependencies||{})};var _e=()=>{let e=de();return Object.keys(e.devDependencies||{})},Q=()=>de().scripts,q=async()=>{var e;try{let t=await(0,me.default)("npm",["ls","--depth=0","--json"],{reject:!1}),r=((e=JSON.parse(t.stdout))==null?void 0:e.dependencies)||{},n=Object.keys(r).filter(a=>a.startsWith("@refinedev")),o=[];for(let a of n){let p=r[a].version;o.push({name:a,version:p})}return o}catch{return Promise.resolve(null)}},Oe=async()=>{let e=["ably","airtable","altogic","antd","appwrite","chakra-ui","codemod","connect","core","graphql","hasura","inferencer","kbar","mantine","medusa","mui","nestjsx-crud","nextjs-router","nhost","react-hook-form","react-location","react-router","react-router-v6","react-table","remix","sdk","simple-rest","strapi","strapi-graphql","strapi-v4","supabase"];try{let t=await(0,Re.default)("node_modules/@refinedev/*",{onlyDirectories:!0}),r=e.flatMap(o=>{try{let a=s.resolve(pe.default.join("@refinedev",o,"package.json"));return[pe.default.dirname(a)]}catch{return[]}}),n=[];return await Promise.all([...r,...t].map(async o=>{if(await(0,D.pathExists)(`${o}/package.json`)){let p=await(0,D.readJSON)(`${o}/package.json`);n.push({name:p.name,path:o})}})),n}catch{return[]}},De=async e=>await(0,D.pathExists)(`${e}/refine.config.js`),B={npm:{install:["install","--save"],installDev:["install","--save-dev"],outdatedJson:["outdated","--json"]},yarn:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--json"]},pnpm:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--format","json"]}},A=async()=>{let e=await W(()=>(0,Se.default)(process.cwd()),"Getting package manager...");if(!e)throw new Error("Package manager not found.");return e},ee=async e=>{let t=await A();try{let r=B[t.name].install,n=(0,me.default)(t.name,[...r,...e],{stdio:"inherit"});n.on("message",o=>{console.log(o)}),n.on("error",o=>{console.log(o)}),n.on("exit",o=>{if(o===0){console.log("All `refine` packages updated  \u{1F389}");return}console.log(`Application exited with code ${o}`)})}catch(r){throw new Error(r)}},Ae=e=>{let t=e.lastIndexOf("@");return t<=0?{name:e,version:null}:{name:e.slice(0,t),version:e.slice(t+1)}};var y=l(s("react")),Fe=l(s("ink-table")),I=s("ink"),je={name:1,current:2,wanted:3,latest:4},mr=4,ue=e=>{let t=e.split(".");return{major:t[0],minor:t[1],patch:t[2]}},$e=(e,t)=>e.major.trim()!==t.major.trim()?{major:"red",minor:"red",patch:"red"}:e.minor.trim()!==t.minor.trim()?{major:"white",minor:"yellow",patch:"yellow"}:e.patch.trim()!==t.patch.trim()?{major:"white",minor:"white",patch:"green"}:{major:"white",minor:"white",patch:"white"},dr=({data:e,command:t})=>{let r=(0,y.useRef)(1),n=(0,y.useRef)(0);return y.default.createElement(I.Box,{width:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"},y.default.createElement(I.Text,null,"Update Available"),y.default.createElement(Fe.default,{data:e,cell:o=>{var x;let a=y.default.createElement(I.Text,null,o.children),p=(x=o.children)==null?void 0:x.toString();if(!p)return a;let i=ue(e[n.current].current);if(r.current===je.wanted){let c=ue(p),d=$e(i,c);a=y.default.createElement(Ue,{major:{color:d.major,text:c.major},minor:{color:d.minor,text:c.minor},patch:{color:d.patch,text:c.patch}})}if(r.current===je.latest){let c=ue(p),d=$e(i,c);a=y.default.createElement(Ue,{major:{color:d.major,text:c.major},minor:{color:d.minor,text:c.minor},patch:{color:d.patch,text:c.patch}})}return r.current===mr?(n.current+=1,r.current=1):r.current+=1,a}}),y.default.createElement(I.Text,null,"To update ",y.default.createElement(I.Text,{bold:!0},"`refine`")," packages with the wanted version"),y.default.createElement(I.Text,null,"Run the following command"," ",y.default.createElement(I.Text,{color:"yellowBright"},t)))},Ue=({major:e,minor:t,patch:r})=>y.default.createElement(I.Text,null,y.default.createElement(I.Text,{color:e.color},e.text),y.default.createElement(I.Text,{color:t.color},".",t.text,"."),y.default.createElement(I.Text,{color:r.color},r.text)),Be=dr;var ur=async()=>{let e="npx @refinedev/cli update",t=G(),r=Object.keys(Q()),n=t.includes("@refinedev/cli"),o=r.includes("refine");if(!n&&!o)return e;let a=await A();return o?`${a.name} run refine update`:n?"npx refine update":e},te=async e=>{let t=await ur();(0,ze.render)(Le.default.createElement(Be,{data:e,command:t}))};var Me=l(s("execa"));var Ve=l(s("semver-diff")),fr=e=>e.command("check-updates").description("Check all installed `refine` packages are up to date").action(gr),gr=async()=>{let e=await W(K,"Checking for updates...");if(!e.length){console.log("All `refine` packages are up to date \u{1F389}\n");return}await te(e)},K=async()=>await hr(),hr=async()=>{let e=await xr();if(!e)return[];let t=[];return Object.keys(e).forEach(n=>{let o=e[n];n.includes("@refinedev")&&t.push({name:n,current:o.current,wanted:o.wanted,latest:o.latest})}),t.filter(n=>!!(0,Ve.default)(n.current,n.latest))},xr=async()=>{let e="npm",{stdout:t,timedOut:r}=await(0,Me.default)(e,B[e].outdatedJson,{reject:!1,timeout:25e3});if(r)throw new Error("Timed out while checking for updates.");return t?JSON.parse(t):null},We=fr;var k=s("fs-extra"),re=l(s("temp")),Ge=s("pluralize"),Ke=l(s("execa")),Ze=l(s("inquirer")),xe=s("path");var L=(i=>(i.REACT_SCRIPT="react-scripts",i.REMIX="remix",i.NEXTJS="nextjs",i.VITE="vite",i.CRACO="craco",i.PARCEL="parcel",i.UNKNOWN="unknown",i))(L||{});var fe=(o=>(o.ANTD="antd",o.MUI="mui",o.MANTINE="mantine",o.CHAKRA="chakra-ui",o))(fe||{});var qe=(n=>(n.NPM="npm",n.YARN="yarn",n.PNPM="pnpm",n))(qe||{});var E=()=>{let e=G(),t=_e();return e.includes("@craco/craco")||t.includes("@craco/craco")?"craco":e.includes("react-scripts")||t.includes("react-scripts")?"react-scripts":e.includes("next")||t.includes("next")?"nextjs":e.includes("@remix-run/react")||t.includes("@remix-run/react")?"remix":e.includes("vite")||t.includes("vite")?"vite":e.includes("parcel")||t.includes("parcel")?"parcel":"unknown"},Xe=()=>{let e=G();if(e.includes("@refinedev/antd"))return"antd";if(e.includes("@refinedev/mui"))return"mui";if(e.includes("@refinedev/chakra-ui"))return"chakra-ui";if(e.includes("@refinedev/mantine"))return"mantine"};var z=l(s("handlebars")),S=s("fs-extra"),wr=(e,t)=>{let r=(0,S.readFileSync)(e);return z.default.registerHelper("ifIn",function(o,a,p){return o.includes(a)?p.fn(z.default):p.inverse(z.default)}),z.default.registerHelper("formatInferencerComponent",function(o){if(o)switch(o){case"chakra-ui":return"ChakraUI";default:return o.charAt(0).toUpperCase()+o.slice(1)}}),z.default.registerHelper("capitalize",function(o){if(o)return o.charAt(0).toUpperCase()+o.slice(1)}),z.default.compile(r.toString())(t)},Ye=(e,t)=>{(0,S.readdirSync)(e).forEach(n=>{let o=`${e}/${n}`,a=`${e}/${n.replace(".hbs","")}`;(0,S.createFileSync)(a),(0,S.writeFileSync)(a,wr(o,t)),(0,S.unlinkSync)(o)})};var He=e=>e.charAt(0).toUpperCase()+e.slice(1);var ge=e=>{switch(e){case"nextjs":return{path:"src/components",alias:"../src/components"};case"remix":return{path:"app/components",alias:"~/components"}}return{path:"src/pages",alias:"pages"}},Je=e=>{switch(e){case"remix":return"./app";case"nextjs":case"react-scripts":case"vite":case"craco":case"parcel":case"unknown":default:return"./src"}};var he=["list","create","edit","show"],yr=e=>{let t=E(),{path:r}=ge(t);return e.command("create-resource").allowExcessArguments(!0).description("Create a new resource files").option("-a, --actions [actions]","Only generate the specified actions. (ex: list,create,edit,show)","list,create,edit,show").option("-p, --path [path]","Path to generate the resource files",r).action(Er)},Er=async(e,t)=>{let{args:r}=t,n=e.actions;if(!r.length){let{name:o,selectedActions:a}=await Ze.default.prompt([{type:"input",name:"name",message:"Resource Name",validate:p=>p?!0:"Resource Name is required"},{type:"checkbox",name:"selectedActions",message:"Select Actions",choices:he,default:e.actions.split(",")}]);r=[o],n=a.join(",")}r.forEach(o=>{let a=n?n.split(","):void 0,{path:p,alias:i}=ge(E()),x=(0,Ge.plural)(o).toLowerCase(),c=(0,xe.join)(process.cwd(),p,x);if((0,k.pathExistsSync)(c)){console.error(`Resource (${(0,xe.join)(p,x)}) already exist! \u274C`);return}let d=He(o),b=Xe(),V=`${__dirname}/../templates/resource`,u=Tr();(0,k.copySync)(V,u);let m={resourceName:o,resource:d,actions:a||he,uiFramework:b};Ye(u,m),a&&he.forEach(P=>{a.includes(P)||(0,k.unlinkSync)(`${u}/${P}.tsx`)}),(0,k.mkdirSync)(e.path,{recursive:!0});let f=`${e.path}/${x}`,g={};(0,k.pathExistsSync)(f)&&(g={overwrite:!0}),(0,k.moveSync)(u,f,g),re.default.cleanupSync();let O=s.resolve(".bin/jscodeshift"),{stderr:T,stdout:F}=Ke.default.sync(O,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/resource.ts`,"--ignore-pattern=**/.cache/**","--ignore-pattern=**/node_modules/**","--ignore-pattern=**/build/**","--ignore-pattern=**/.next/**",`--__actions=${m.actions}`,`--__pathAlias=${i}`,`--__resourceFolderName=${x}`,`--__resource=${d}`,`--__resourceName=${o}`]);T&&console.log(T),console.log(`Resource (${f}) generated successfully! \u{1F389}`)})},Tr=()=>(re.default.track(),re.default.mkdirSync("resource")),Qe=yr;var et=l(s("dotenv"));et.config();var Pr={development:/dev/i,production:/prod/i,test:/test|tst/i,"continuous-integration":/ci/i,"user-acceptance-testing":/uat/i,"system-integration-testing":/sit/i},Ir=()=>{let e=process.env.NODE_ENV;if(!e)return"development";let t="custom";for(let[r,n]of Object.entries(Pr))if(n.test(e)){t=r;break}return t},N={NODE_ENV:Ir(),REFINE_NO_TELEMETRY:process.env.REFINE_NO_TELEMETRY||"false",UPDATE_NOTIFIER_IS_DISABLED:process.env.UPDATE_NOTIFIER_IS_DISABLED||"false",UPDATE_NOTIFIER_CACHE_TTL:process.env.UPDATE_NOTIFIER_CACHE_TTL||1e3*60*60*24,REFINE_PROXY_DOMAIN:process.env.REFINE_PROXY_DOMAIN||"https://refine.dev",REFINE_PROXY_TARGET:process.env.REFINE_PROXY_TARGET||"http://localhost:3000",REFINE_PROXY_PORT:process.env.REFINE_PROXY_PORT||"7313",REFINE_PROXY_REWRITE_URL:process.env.REFINE_REWRITE_URL||"http://localhost:7313"};var tt=l(s("express")),oe=s("http-proxy-middleware"),Cr=e=>e.command("proxy").description("Manage proxy settings").action(vr).option("-p, --port [port]","Port to serve the proxy server. You can also set this with the `REFINE_PROXY_PORT` environment variable.",N.REFINE_PROXY_PORT).option("-t, --target [target]","Target to proxy. You can also set this with the `REFINE_PROXY_TARGET` environment variable.",N.REFINE_PROXY_TARGET).option("-d, --domain [domain]","Domain to proxy. You can also set this with the `REFINE_PROXY_DOMAIN` environment variable.",N.REFINE_PROXY_DOMAIN).option("-r, --rewrite-url [rewrite URL]","Rewrite URL for redirects. You can also set this with the `REFINE_PROXY_REWRITE_URL` environment variable.",N.REFINE_PROXY_REWRITE_URL),vr=async({port:e,target:t,domain:r,rewriteUrl:n})=>{let o=(0,tt.default)(),p=new URL(t).protocol==="http:"?i=>{var x;i.headers["set-cookie"]&&((x=i.headers["set-cookie"])==null||x.forEach((c,d)=>{i&&i.headers&&i.headers["set-cookie"]&&(i.headers["set-cookie"][d]=c.replace("Secure;",""))}))}:void 0;o.use("/.refine",(0,oe.createProxyMiddleware)({target:`${r}/.refine`,changeOrigin:!0,pathRewrite:{"^/.refine":""},logProvider:()=>({log:console.log,info:i=>{`${i}`.includes("Proxy rewrite rule created")||(`${i}`.includes("Proxy created")?console.log(`Proxying localhost:${e}/.refine to ${r}/.refine`):i&&console.log(i))},warn:console.warn,debug:console.debug,error:console.error})})),o.use("/.auth",(0,oe.createProxyMiddleware)({target:`${r}/.auth`,changeOrigin:!0,cookieDomainRewrite:{"refine.dev":""},headers:{"auth-base-url-rewrite":`${n}/.auth`},pathRewrite:{"^/.auth":""},logProvider:()=>({log:console.log,info:i=>{`${i}`.includes("Proxy rewrite rule created")||(`${i}`.includes("Proxy created")?console.log(`Proxying localhost:${e}/.auth to ${r}/.auth`):i&&console.log(i))},warn:console.warn,debug:console.debug,error:console.error}),onProxyRes:p})),o.use("*",(0,oe.createProxyMiddleware)({target:`${t}`,changeOrigin:!0,ws:!0,logProvider:()=>({log:console.log,info:i=>{`${i}`.includes("Proxy created")?console.log(`Proxying localhost:${e} to ${t}`):i&&console.log(i)},warn:console.warn,debug:console.debug,error:console.error})})),o.listen(Number(e))},rt=Cr;var R={["react-scripts"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>s.resolve(".bin/react-scripts")},["vite"]:{dev:["dev"],start:["preview"],build:["build"],getBin:()=>s.resolve(".bin/vite")},["nextjs"]:{dev:["dev"],start:["start"],build:["build"],getBin:()=>s.resolve(".bin/next")},["remix"]:{dev:["dev"],start:["build"],build:["build"],getBin:e=>{let t=e==="start"?"remix-serve":"remix";return s.resolve(`.bin/${t}`)}},["craco"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>s.resolve(".bin/craco")},["parcel"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>s.resolve(".bin/parcel")},["unknown"]:{dev:[],start:[],build:[],getBin:()=>"unknown"}};var ot=l(s("execa")),j=async(e,t)=>{var n,o;if(e==="unknown"){let a=Object.values(L).filter(p=>p!=="unknown").join(", ");console.error(`We couldn't find executable for your project. Supported executables are ${a}.
Please use your own script directly. If you think this is an issue, please report it at: https://github.com/refinedev/refine/issues`);return}let r=(0,ot.default)(e,t,{stdio:"pipe",windowsHide:!1,env:{FORCE_COLOR:"true",...process.env}});return(n=r.stdout)==null||n.pipe(process.stdout),(o=r.stderr)==null||o.pipe(process.stderr),await r};var at=l(s("conf")),it=l(s("chalk"));var nt=e=>typeof btoa<"u"?btoa(e):Buffer.from(e).toString("base64");var br="refine-update-notifier",$=new at.default({projectName:br,defaults:{key:"",lastUpdated:0,packages:[]}}),X=async()=>{if(_r())return;let e=await Nr();if(e!==null){if(e){st();return}kr(),st()}},kr=async()=>{let e=$.get("packages");e!=null&&e.length&&(await te(e),console.log(`
`))},Nr=async()=>{let e=await Sr(),t=Rr();return e===null?null:!!(t||!e)},st=async()=>{try{let e=await K();return $.set("packages",e),$.set("lastUpdated",Date.now()),$.set("key",await ct()),e}catch{return $.set("packages",[]),$.set("lastUpdated",Date.now()),$.set("key",""),null}},Rr=()=>{let e=$.get("lastUpdated");if(!e)return!0;let r=Date.now()-e,n=Number(N.UPDATE_NOTIFIER_CACHE_TTL);return r>=n},Sr=async()=>{let e=$.get("key"),t=await ct();return t===null?null:e===t},ct=async()=>{let e=await q();if(!e)return console.error(it.default.red("Something went wrong when trying to get installed `refine` packages.")),null;let t=e.map(n=>`${n.name}@${n.version}`);return nt(t.toString())},_r=()=>N.UPDATE_NOTIFIER_IS_DISABLED.toLocaleLowerCase()==="true";var Y=e=>{let t=E(),r=R[t][e];return t==="remix"&&e==="start"&&(t="remix-serve"),`It runs: \`${t} ${r.join(" ")}\`. Also accepts all the arguments \`${t}\` accepts.`};var Or=e=>e.command("start").description(Y("start")).allowUnknownOption(!0).argument("[args...]").action(Dr),Dr=async e=>{let t=E(),r=R[t].getBin("start"),o=[...R[t].start,...e];await X(),j(r,o)},we=Or;var Ar=e=>e.command("dev").description(Y("dev")).allowUnknownOption(!0).argument("[args...]").action(jr),jr=async e=>{let t=E(),r=R[t].getBin("dev"),o=[...R[t].dev,...e];await X(),j(r,o)},ye=Ar;var $r=e=>e.command("build").description(Y("build")).allowUnknownOption(!0).argument("[args...]").action(Ur),Ur=async e=>{let t=E(),r=R[t].getBin("build"),o=[...R[t].build,...e];await X();try{await j(r,o)}catch{process.exit(1)}},Ee=$r;var Te=l(s("chalk"));var Fr=e=>e.command("run").description("Runs a defined package script. If no `command` is provided, it will list the available scripts").allowUnknownOption(!0).argument("[command] [args...]").action(Br),Br=async e=>{let[t,...r]=e,n=Q();if(!t){console.log(`Available via ${Te.default.blue("`refine run`")}:
`);for(let[p,i]of Object.entries(n))console.log(`  ${p}`),console.log(`    ${Te.default.dim(i)}`),console.log();return}if(!Object.keys(n).includes(t)){let p=`${process.cwd()}/node_modules/.bin/${t}`;j(p,r);return}let a=await A();j(a.name,["run",t,...r])},Pe=Fr;var Ot=l(s("react")),Dt=s("ink"),be=l(s("path")),M=l(s("chalk")),Z=l(s("inquirer")),At=l(s("inquirer-autocomplete-prompt")),U=s("fs-extra");var Ce=l(s("path"));var gt=l(s("path"));var Ie={};cr(Ie,{PackageManagerTypes:()=>qe,ProjectTypes:()=>L,UIFrameworks:()=>fe,appendAfterImports:()=>dt,getFileContent:()=>ne,getImports:()=>H,getNameChangeInImport:()=>pt});var Lr=/import(?:(?:(?:[ \n\t]+([^ *\n\t\{\},]+)[ \n\t]*(?:,|[ \n\t]+))?([ \n\t]*\{(?:[ \n\t]*[^ \n\t"'\{\}]+[ \n\t]*,?)+\})?[ \n\t]*)|[ \n\t]*\*[ \n\t]*as[ \n\t]+([^ \n\t\{\}]+)[ \n\t]+)from[ \n\t]*(?:['"])([^'"\n]+)(?:['"])(?:;?)/g,zr=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,H=e=>{let t=e.matchAll(Lr),r=[];for(let n of t){let[o,a,p,i,x]=n;r.push({statement:o,importPath:x,...a&&{defaultImport:a},...p&&{namedImports:p},...i&&{namespaceImport:i}})}return r==null?void 0:r.filter(Boolean)},pt=e=>{let t=e.matchAll(zr),r=[];for(let n of t){let[o,a,p,i,x]=n;r.push({statement:o,fromName:a.trim(),toName:i.trim(),afterCharacter:x})}return r},Mr=(e,t)=>{var a;let r=e.substring(0,e.indexOf(t.statement)),n=H(r).pop();return n?r.substring(r.indexOf(n==null?void 0:n.statement)+((a=n==null?void 0:n.statement)==null?void 0:a.length)):r},Vr=(e,t)=>!!(t?Mr(e,t):"").trim(),lt=["react","@refinedev/core","@refinedev/"],mt=e=>{var u;let t=e,r=H(e),n=r.filter(m=>!m.statement.includes("import type ")),o=r.filter(m=>m.statement.includes("import type")),a=[],p=[];n.forEach(m=>{Vr(e,m)?a.push(m):p.push(m)});let i=t.indexOf((u=p==null?void 0:p[0])==null?void 0:u.statement);p.forEach(m=>{t=t.replace(m.statement,"")}),o.forEach(m=>{t=t.replace(m.statement,"")});let x=p.reduce((m,f)=>{let{importPath:g}=f;return m[g]?m[g].push(f):m[g]=[f],m},{}),b=[...Object.entries(x).map(([m,f])=>{let g=f.find(P=>P.defaultImport),O=f.find(P=>P.namespaceImport),T=f.filter(P=>P.namedImports).map(P=>(P.namedImports??"").replace(/{|}/g,"").trim().split(",").map(ce=>ce.trim()).filter(Boolean).join(", ")).join(", "),F="";return O&&(F+=O.statement+`
`),(g||T)&&(g&&T?F+=`import ${g.defaultImport}, { ${T} } from "${f[0].importPath}";
`:g?F+=`import ${g.defaultImport} from "${f[0].importPath}";
`:F+=`import { ${T} } from "${f[0].importPath}";
`),[m,F]})].sort(([m],[f])=>{let g=lt.findIndex(T=>m.includes(T)),O=lt.findIndex(T=>f.includes(T));return g===O?m.localeCompare(f):g===-1?1:O===-1?-1:g-O}).map(([,m])=>m).join(""),V=o.map(m=>m.statement).join(`
`);return t=t.substring(0,i)+b+V+t.substring(i),t};var dt=(e,t)=>{let r=H(e),n=r[r.length-1],o=n?e.indexOf(n.statement):e.length-1;return e.slice(0,o+(n==null?void 0:n.statement.length))+`
`+t+`
`+e.slice(o+(n==null?void 0:n.statement.length))};var ut=s("fs-extra"),ft=s("path");function ne(e){if(this!=null&&this.absolutePackageDir)try{return(0,ut.readFileSync)((0,ft.join)(this.absolutePackageDir,e)).toString()}catch{return}}var ht=s("module"),Wr=ht.prototype.require,xt=(e,t)=>{ht.prototype.require=function(...r){return r[0]==="@refinedev/cli"?{...Ie,getFileContent:n=>ne.call({absolutePackageDir:t?e:gt.default.join(process.cwd(),e)},n)}:Wr.apply(this,r)}};var ve=async(e,t)=>{try{return xt(e,t),s(Ce.default.join(t?e:Ce.default.join(process.cwd(),e),"refine.config.js"))}catch{return}};var se=s("prettier"),wt=async e=>{try{let t=await(0,se.resolveConfig)(process.cwd());return(0,se.format)(e,{...t??{},parser:"typescript"})}catch{return e}};var h=l(s("react")),It=l(s("ink-markdown")),Ct=l(s("dedent")),w=s("ink");var C={SUCCESS:"SUCCESS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SOURCE_PATH_NOT_FOUND:"SOURCE_PATH_NOT_FOUND",TARGET_PATH_NOT_FOUND:"TARGET_PATH_NOT_FOUND",SOURCE_PATH_NOT_A_FILE:"SOURCE_PATH_NOT_A_FILE",TARGET_ALREADY_EXISTS:"TARGET_ALREADY_EXISTS"};var yt=l(s("chalk")),Et=l(s("cardinal")),Tt=l(s("boxen")),qr=e=>{let t=/^(?:\/\/\s?title:\s?)(.*?)\n/g,[r,n]=t.exec(e)??[];if(n){let o=n.trim(),a=e.replace(r,"");return{title:o,code:a}}return{code:e}},Pt=e=>{let{title:t,code:r}=qr(e),n="";try{n=Et.default.highlight(r,{jsx:!0})}catch{n=r}return(0,Tt.default)(n,{padding:1,margin:0,borderStyle:"round",borderColor:"gray",titleAlignment:"left",title:t?yt.default.bold(t):void 0})};var Xr=({label:e,files:t,message:r="**`Warning:`** You should use the component where you want to use it."})=>{let n=t.filter(([,c])=>Object.values(C).filter(d=>d!==C.SUCCESS).includes(c)),o="success";switch(n.length){case 0:o="success";break;case t.length:o="error";break;default:o="warning";break}let a=()=>{switch(o){case"success":return h.default.createElement(w.Text,{color:"blueBright"},"Successfully swizzled ",h.default.createElement(w.Text,{bold:!0},e));case"warning":return h.default.createElement(w.Text,{color:"yellowBright"},"Swizzle completed with errors for"," ",h.default.createElement(w.Text,{bold:!0},e));case"error":return h.default.createElement(w.Text,{color:"redBright"},"Swizzle failed for ",h.default.createElement(w.Text,{bold:!0},e))}return null},p=c=>{let d=c==null?void 0:c.replace(process.cwd(),"");return d!=null&&d.startsWith("/")?d.slice(1):d!=null&&d.startsWith("./")?d.slice(2):d},i=()=>h.default.createElement(h.default.Fragment,null,h.default.createElement(w.Text,{dimColor:!0},"File",t.length>1?"s":""," created:"),t.map(([c,d],b)=>d===C.SUCCESS?h.default.createElement(w.Text,{key:b,dimColor:!0,color:"cyanBright"},` - ${p(c)}`):d===C.TARGET_ALREADY_EXISTS?h.default.createElement(w.Text,{key:b,dimColor:!0,color:"cyanBright"}," - ",h.default.createElement(w.Text,{color:"yellowBright",bold:!0},"[FILE_ALREADY_EXISTS]"," "),`${p(c)}`):d===C.SOURCE_PATH_NOT_A_FILE?h.default.createElement(w.Text,{key:b,dimColor:!0,color:"cyanBright"}," - ",h.default.createElement(w.Text,{color:"yellowBright",bold:!0},"[SOURCE NOT FOUND]"," "),`${p(c)}`):h.default.createElement(w.Text,{key:b,dimColor:!0,color:"cyanBright"}," - ",h.default.createElement(w.Text,{color:"yellowBright",bold:!0},"[",d,"]")))),x=()=>r&&o!=="error"?h.default.createElement(h.default.Fragment,null,h.default.createElement(It.default,{code:Pt},(0,Ct.default)(`
`+r)),h.default.createElement(w.Text,null,"\xA0")):null;return h.default.createElement(w.Box,{width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start"},h.default.createElement(w.Text,null,"\xA0"),a(),i(),h.default.createElement(w.Text,null,"\xA0"),x())},vt=Xr;var bt=e=>{let t=/(\/\/|\/\*)(\s?)swizzle-remove-start([\s\S]*?)(\/\/|\/\*)(\s?)swizzle-remove-end(\s*)(\*\/)?/g;return e.replace(t,"")};var jt=l(s("boxen"));var kt=()=>{let e;try{e=E()}catch{e=void 0}return Je(e)};var Nt=l(s("inquirer")),Rt=l(s("chalk"));var St=async e=>{await Yr(e)?await ee(e):await Hr(e)},Yr=async e=>{let t=`This component requires following packages to be installed:
`.concat(e.map(n=>` - ${n}`).join(`
`)).concat(`
Do you want to install them?`),{installRequiredPackages:r}=await Nt.default.prompt([{type:"confirm",name:"installRequiredPackages",default:!0,message:t}]);return r},Hr=async e=>{let t=await A(),r=B[t.name].install.join(" "),n=e.join(" "),o=`${t.name} ${r} ${n}`;console.log(`
You can install them manually by running this command:`),console.log(Rt.default.bold.blueBright(o))};var Jr=e=>e.command("swizzle").description(`Export a component or a function from ${M.default.bold("refine")} packages to customize it in your project`).action(Gr),_t=e=>(t,r="")=>e.filter(o=>{var a;return o.label.toLowerCase().includes(r.toLowerCase())||((a=o.group)==null?void 0:a.toLowerCase().includes(r.toLowerCase()))}).flatMap((o,a,p)=>{var c;return[...(o==null?void 0:o.group)&&((c=p[a-1])==null?void 0:c.group)!==o.group&&o.group?[new Z.default.Separator(`${M.default.bold(o.group)}`)]:[],{name:` ${o.label}`,value:o!=null&&o.value?o.value:o}]}),Gr=async e=>{var d,b,V;Z.default.registerPrompt("autocomplete",At.default);let t=await Oe(),r=[];if(await Promise.all(t.map(async u=>{let m=await De(u.path),f=r.findIndex(g=>g.name===u.name)===-1;m&&f&&r.push(u)})),r.length===0){console.log("No refine packages found with swizzle configuration.");return}console.log(`${(0,jt.default)(`Found ${M.default.blueBright(r.length)} installed ${M.default.blueBright.bold("refine")} packages with swizzle configuration.`,{padding:1,textAlignment:"center",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"})}
`);let n=await Promise.all(r.map(async u=>{let m=await ve(u.path,!0)??await ve(u.path,!1)??{swizzle:{items:[]}};return{...u,config:m}})),{selectedPackage:o}=await Z.default.prompt([{type:"autocomplete",pageSize:10,name:"selectedPackage",message:"Which package do you want to swizzle?",emptyText:"No packages found.",source:_t(n.sort((u,m)=>{var f,g;return(((f=u.config)==null?void 0:f.group)??"").localeCompare(((g=m.config)==null?void 0:g.group)??"")}).map(u=>{var m,f;return{label:((m=u.config)==null?void 0:m.name)??u.name,value:u,group:(f=u.config)==null?void 0:f.group}}))}]),{swizzle:{items:a,transform:p}}=o.config,i;if(a.length===0){console.log(`No swizzle items found for ${M.default.bold(((d=o.config)==null?void 0:d.name)??o.name)}`);return}else a.length===1?i=a[0]:a.length>1&&(i=(await Z.default.prompt([{type:"list",pageSize:10,name:"selectedComponent",message:"Which component do you want to swizzle?",emptyText:"No components found.",choices:_t(a.sort((m,f)=>m.group.localeCompare(f.group)))({},"")}])).selectedComponent);if(!i){console.log(`No swizzle items selected for ${M.default.bold(((b=o.config)==null?void 0:b.name)??o.name)}`);return}let x=kt(),c=await Promise.all(i.files.map(async u=>{var m;try{let f=u.src?be.default.join(o.path,u.src):void 0,g=u.dest?be.default.join(process.cwd(),x,u.dest):void 0;if(!f)return console.log("No src path found for file",u),["",C.SOURCE_PATH_NOT_FOUND];if(!g)return console.log("No destination path found for file",u),["",C.TARGET_PATH_NOT_FOUND];if(!await(0,U.pathExists)(f))return[g,C.SOURCE_PATH_NOT_A_FILE];let T=await(0,U.readFile)(f,"utf-8");if(await(0,U.pathExists)(g))return[g,C.TARGET_ALREADY_EXISTS];await(0,U.ensureFile)(g);let P=bt(T),ie=((m=u.transform)==null?void 0:m.call(u,P))??P,ce=(p==null?void 0:p(ie,f,g))??ie,tr=mt(ce),rr=await wt(tr);return await(0,U.writeFile)(g,rr),[g,C.SUCCESS]}catch{return["",C.UNKNOWN_ERROR]}}));if(c.length>0){let{unmount:u}=(0,Dt.render)(Ot.default.createElement(vt,{label:i.label,files:c,message:i.message}));u(),(V=i==null?void 0:i.requiredPackages)!=null&&V.length&&await St(i.requiredPackages)}},$t=Jr;var Bt=s("commander");var J=l(s("inquirer")),ke=l(s("semver-diff")),ae=l(s("chalk"));var Ut=e=>{let t=e.filter((n,o)=>e.indexOf(n)!==o),r=new Set(t);return Array.from(r)};var Ft=async e=>{let t=Zr(e);if(!t){console.log("All `refine` packages are up to date. \u{1F389}");return}let r=Qr(t),n=await J.default.prompt([{type:"checkbox",name:"packages",message:"Choose packages to update",pageSize:r.pageSize,choices:r.choices,validate:Kr}]);return n.packages.length>0?n.packages:null},Kr=e=>{let r=e.map(o=>Ae(o)).map(o=>o.name),n=Ut(r);return n.length>0?`You can't update the same package more than once. Please choice one.
 Duplicates: ${n.join(", ")}`:!0},Zr=e=>{if(e.length===0)return null;let t={patch:[],minor:[],major:[]};return e.forEach(r=>{let n=r.current,o=(0,ke.default)(n,r.wanted),a=(0,ke.default)(n,r.latest);if(o===a&&a){t[a].push({name:r.name,from:n,to:r.latest});return}o&&t[o].push({name:r.name,from:n,to:r.wanted}),a&&t[a].push({name:r.name,from:n,to:r.latest})}),t},Qr=e=>{let t=0,r=0;[e.patch,e.minor,e.major].forEach(c=>{c.forEach(d=>{d.name.length>t&&(t=d.name.length),d.from.length>r&&(r=d.from.length)})}),t+=2;let n=[],o="Package".padEnd(t),a="From".padEnd(r),i=`
   ${o} ${a}${"To".padStart(r)}`;n.push(new J.default.Separator(i)),e.patch.length>0&&(n.push(new J.default.Separator(ae.default.reset.bold.blue(`
Patch Updates`))),e.patch.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})})),e.minor.length>0&&(n.push(new J.default.Separator(ae.default.reset.bold.blue(`
Minor Updates`))),e.minor.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})})),e.major.length>0&&(n.push(new J.default.Separator(ae.default.reset.bold.blue(`
Major Updates`))),e.major.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})}));let x=n.length+6;return{choices:n,pageSize:x}};var eo=e=>e.command("update").description("Interactively select and update all `refine` packages to selected version. To skip the interactive mode, use the `--all` option.").addOption(new Bt.Option("-t, --tag [tag]","Select version to update to.").choices(["next","latest"]).default("wanted","Version ranges in the `package.json` will be installed")).option("-a, --all","Update all `refine` packages to the selected `tag`. If `tag` is not provided, version ranges in the `package.json` will be installed. This option skips the interactive mode.",!1).option("-d, --dry-run","Get outdated packages installation command without automatic updating. If `tag` is not provided, version ranges in the `package.json` will be used.",!1).action(to),to=async e=>{let{tag:t,dryRun:r,all:n}=e,o=await W(K,"Checking for updates...");if(!(o!=null&&o.length)){console.log("All `refine` packages are up to date \u{1F389}");return}let a=n?ro(t,o):await Ft(o);if(a){if(r){oo(a);return}no(a)}},ro=(e,t)=>e==="wanted"&&t.every(o=>o.current===o.wanted)?(console.log("All `refine` packages are up to date with the wanted version \u{1F389}"),null):t.map(n=>{let o=e==="wanted"?n.wanted:e;return`${n.name}@${o}`}),oo=async e=>{let t=await A(),r=B[t.name].install;console.log(`${t.name} ${r.join(" ")} ${e.join(" ")}`)},no=e=>{console.log("Updating `refine` packages..."),console.log(e),ee(e)},Lt=eo;var zt=l(s("envinfo")),Mt=l(s("ora")),so=e=>e.command("whoami").description("View the details of the development environment").action(ao),ao=async()=>{let e=(0,Mt.default)("Loading environment details...").start(),t=await zt.default.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Firefox","Safari"]},{showNotFound:!0,markdown:!0}),n=(await q()||[]).map(o=>` - ${o.name}: ${o.version}`).join(`
`);e.stop(),console.log(t),console.log("## Refine Packages:"),console.log(n)},Vt=so;var Wt=l(s("envinfo")),qt=l(s("os")),io=()=>{let e=qt.default.type();return{Darwin:"macOS",Linux:"Linux",Windows_NT:"Windows"}[e]},Xt=async()=>{let[e,t]=await Wt.default.helpers.getOSInfo();return{name:io(),version:t}};var Yt=l(s("node-fetch")),co=async()=>{let e=await Xt();return{nodeEnv:N.NODE_ENV,nodeVersion:process.version,os:e.name,osVersion:e.version,command:process.argv[2],packages:await q()||[],projectFramework:E()}},Ht=async()=>{if(N.REFINE_NO_TELEMETRY!=="true")try{let e=await co();await(0,Yt.default)("https://telemetry.refine.dev/cli",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}catch{}};var Gt=l(s("react"));var v=s("ink"),_=l(s("react")),lo=()=>_.default.createElement(v.Box,{flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",borderColor:"greenBright",borderStyle:"double",padding:1},_.default.createElement(v.Text,{color:"greenBright"},"\u2705 Zero-trust security model"),_.default.createElement(v.Text,{color:"greenBright"},"\u2705 User/role management"),_.default.createElement(v.Text,{color:"greenBright"},"\u2705 Granular access control"),_.default.createElement(v.Text,{color:"greenBright"},"\u2705 Directory sync"),_.default.createElement(v.Text,{color:"greenBright"},"\u2705 VPN-less secure deployments"),_.default.createElement(v.Text,{color:"greenBright"},"\u2705 Direct connection to DBs"),_.default.createElement(v.Newline,null),_.default.createElement(v.Text,null,"Interested in any of the new backend features of refine? Join now and get early access -> https://s.refine.dev/meet-enterprise")),Jt=lo;var Kt=s("ink"),po=()=>(0,Kt.render)(Gt.default.createElement(Jt,null)),Zt=po;var mo="1.0.0",uo=()=>{let e=new Qt.Command;e.version(`@refinedev/cli@${mo}`,"-v, --version","Output the current version.").description(er.default.textSync("refine",{font:"Isometric1",horizontalLayout:"full",verticalLayout:"full",whitespaceBreak:!0})).usage("<command> [options]").helpOption("-h, --help","Output usage information."),$t(e),Qe(e),Lt(e),ye(e),Ee(e),we(e),Pe(e),We(e),Vt(e),rt(e),e.hook("preAction",t=>{Zt()}),e.hook("postAction",t=>{let r=t.args[0];["run"].includes(r)||Ht()}),e.parse(process.argv),process.argv.slice(2).length||e.outputHelp()};uo();})();
//# sourceMappingURL=cli.js.map