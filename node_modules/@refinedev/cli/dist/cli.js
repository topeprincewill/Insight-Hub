#!/usr/bin/env node
var rr=Object.create;var ce=Object.defineProperty;var or=Object.getOwnPropertyDescriptor;var nr=Object.getOwnPropertyNames;var sr=Object.getPrototypeOf,ar=Object.prototype.hasOwnProperty;var ir=(e,t)=>{for(var r in t)ce(e,r,{get:t[r],enumerable:!0})},cr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of nr(t))!ar.call(e,o)&&o!==r&&ce(e,o,{get:()=>t[o],enumerable:!(n=or(t,o))||n.enumerable});return e};var i=(e,t,r)=>(r=e!=null?rr(sr(e)):{},cr(t||!e||!e.__esModule?ce(r,"default",{value:e,enumerable:!0}):r,e));var Zt=require("commander"),Qt=i(require("figlet"));var Be=i(require("react")),Le=require("ink");var O=require("fs-extra"),pe=i(require("execa")),be=i(require("globby")),le=i(require("path")),Re=i(require("preferred-pm"));var Ne=i(require("ora")),lr=async(e,t)=>{let r=(0,Ne.default)({color:"cyan",text:t}).start(),n=await e();return r.stop(),n},V=lr;var me=()=>{if(!(0,O.existsSync)("package.json"))throw new Error("./package.json not found");return JSON.parse((0,O.readFileSync)("package.json","utf8"))},J=()=>{let e=me();return Object.keys(e.dependencies||{})};var Se=()=>{let e=me();return Object.keys(e.devDependencies||{})},Z=()=>me().scripts,W=async()=>{var e;try{let t=await(0,pe.default)("npm",["ls","--depth=0","--json"],{reject:!1}),r=((e=JSON.parse(t.stdout))==null?void 0:e.dependencies)||{},n=Object.keys(r).filter(s=>s.startsWith("@refinedev")),o=[];for(let s of n){let l=r[s].version;o.push({name:s,version:l})}return o}catch{return Promise.resolve(null)}},_e=async()=>{let e=["ably","airtable","altogic","antd","appwrite","chakra-ui","codemod","connect","core","graphql","hasura","inferencer","kbar","mantine","medusa","mui","nestjsx-crud","nextjs-router","nhost","react-hook-form","react-location","react-router","react-router-v6","react-table","remix","sdk","simple-rest","strapi","strapi-graphql","strapi-v4","supabase"];try{let t=await(0,be.default)("node_modules/@refinedev/*",{onlyDirectories:!0}),r=e.flatMap(o=>{try{let s=require.resolve(le.default.join("@refinedev",o,"package.json"));return[le.default.dirname(s)]}catch{return[]}}),n=[];return await Promise.all([...r,...t].map(async o=>{if(await(0,O.pathExists)(`${o}/package.json`)){let l=await(0,O.readJSON)(`${o}/package.json`);n.push({name:l.name,path:o})}})),n}catch{return[]}},Oe=async e=>await(0,O.pathExists)(`${e}/refine.config.js`),F={npm:{install:["install","--save"],installDev:["install","--save-dev"],outdatedJson:["outdated","--json"]},yarn:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--json"]},pnpm:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--format","json"]}},D=async()=>{let e=await V(()=>(0,Re.default)(process.cwd()),"Getting package manager...");if(!e)throw new Error("Package manager not found.");return e},Q=async e=>{let t=await D();try{let r=F[t.name].install,n=(0,pe.default)(t.name,[...r,...e],{stdio:"inherit"});n.on("message",o=>{console.log(o)}),n.on("error",o=>{console.log(o)}),n.on("exit",o=>{if(o===0){console.log("All `refine` packages updated  \u{1F389}");return}console.log(`Application exited with code ${o}`)})}catch(r){throw new Error(r)}},De=e=>{let t=e.lastIndexOf("@");return t<=0?{name:e,version:null}:{name:e.slice(0,t),version:e.slice(t+1)}};var w=i(require("react")),Ue=i(require("ink-table")),P=require("ink"),Ae={name:1,current:2,wanted:3,latest:4},pr=4,de=e=>{let t=e.split(".");return{major:t[0],minor:t[1],patch:t[2]}},je=(e,t)=>e.major.trim()!==t.major.trim()?{major:"red",minor:"red",patch:"red"}:e.minor.trim()!==t.minor.trim()?{major:"white",minor:"yellow",patch:"yellow"}:e.patch.trim()!==t.patch.trim()?{major:"white",minor:"white",patch:"green"}:{major:"white",minor:"white",patch:"white"},mr=({data:e,command:t})=>{let r=(0,w.useRef)(1),n=(0,w.useRef)(0);return w.default.createElement(P.Box,{width:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"},w.default.createElement(P.Text,null,"Update Available"),w.default.createElement(Ue.default,{data:e,cell:o=>{var h;let s=w.default.createElement(P.Text,null,o.children),l=(h=o.children)==null?void 0:h.toString();if(!l)return s;let a=de(e[n.current].current);if(r.current===Ae.wanted){let c=de(l),m=je(a,c);s=w.default.createElement($e,{major:{color:m.major,text:c.major},minor:{color:m.minor,text:c.minor},patch:{color:m.patch,text:c.patch}})}if(r.current===Ae.latest){let c=de(l),m=je(a,c);s=w.default.createElement($e,{major:{color:m.major,text:c.major},minor:{color:m.minor,text:c.minor},patch:{color:m.patch,text:c.patch}})}return r.current===pr?(n.current+=1,r.current=1):r.current+=1,s}}),w.default.createElement(P.Text,null,"To update ",w.default.createElement(P.Text,{bold:!0},"`refine`")," packages with the wanted version"),w.default.createElement(P.Text,null,"Run the following command"," ",w.default.createElement(P.Text,{color:"yellowBright"},t)))},$e=({major:e,minor:t,patch:r})=>w.default.createElement(P.Text,null,w.default.createElement(P.Text,{color:e.color},e.text),w.default.createElement(P.Text,{color:t.color},".",t.text,"."),w.default.createElement(P.Text,{color:r.color},r.text)),Fe=mr;var dr=async()=>{let e="npx @refinedev/cli update",t=J(),r=Object.keys(Z()),n=t.includes("@refinedev/cli"),o=r.includes("refine");if(!n&&!o)return e;let s=await D();return o?`${s.name} run refine update`:n?"npx refine update":e},ee=async e=>{let t=await dr();(0,Le.render)(Be.default.createElement(Fe,{data:e,command:t}))};var ze=i(require("execa"));var Me=i(require("semver-diff")),ur=e=>e.command("check-updates").description("Check all installed `refine` packages are up to date").action(fr),fr=async()=>{let e=await V(G,"Checking for updates...");if(!e.length){console.log("All `refine` packages are up to date \u{1F389}\n");return}await ee(e)},G=async()=>await gr(),gr=async()=>{let e=await hr();if(!e)return[];let t=[];return Object.keys(e).forEach(n=>{let o=e[n];n.includes("@refinedev")&&t.push({name:n,current:o.current,wanted:o.wanted,latest:o.latest})}),t.filter(n=>!!(0,Me.default)(n.current,n.latest))},hr=async()=>{let e="npm",{stdout:t,timedOut:r}=await(0,ze.default)(e,F[e].outdatedJson,{reject:!1,timeout:25e3});if(r)throw new Error("Timed out while checking for updates.");return t?JSON.parse(t):null},Ve=ur;var k=require("fs-extra"),te=i(require("temp")),Je=require("pluralize"),Ge=i(require("execa")),Ke=i(require("inquirer")),he=require("path");var B=(a=>(a.REACT_SCRIPT="react-scripts",a.REMIX="remix",a.NEXTJS="nextjs",a.VITE="vite",a.CRACO="craco",a.PARCEL="parcel",a.UNKNOWN="unknown",a))(B||{});var ue=(o=>(o.ANTD="antd",o.MUI="mui",o.MANTINE="mantine",o.CHAKRA="chakra-ui",o))(ue||{});var We=(n=>(n.NPM="npm",n.YARN="yarn",n.PNPM="pnpm",n))(We||{});var y=()=>{let e=J(),t=Se();return e.includes("@craco/craco")||t.includes("@craco/craco")?"craco":e.includes("react-scripts")||t.includes("react-scripts")?"react-scripts":e.includes("next")||t.includes("next")?"nextjs":e.includes("@remix-run/react")||t.includes("@remix-run/react")?"remix":e.includes("vite")||t.includes("vite")?"vite":e.includes("parcel")||t.includes("parcel")?"parcel":"unknown"},qe=()=>{let e=J();if(e.includes("@refinedev/antd"))return"antd";if(e.includes("@refinedev/mui"))return"mui";if(e.includes("@refinedev/chakra-ui"))return"chakra-ui";if(e.includes("@refinedev/mantine"))return"mantine"};var L=i(require("handlebars")),R=require("fs-extra"),xr=(e,t)=>{let r=(0,R.readFileSync)(e);return L.default.registerHelper("ifIn",function(o,s,l){return o.includes(s)?l.fn(L.default):l.inverse(L.default)}),L.default.registerHelper("formatInferencerComponent",function(o){if(o)switch(o){case"chakra-ui":return"ChakraUI";default:return o.charAt(0).toUpperCase()+o.slice(1)}}),L.default.registerHelper("capitalize",function(o){if(o)return o.charAt(0).toUpperCase()+o.slice(1)}),L.default.compile(r.toString())(t)},Xe=(e,t)=>{(0,R.readdirSync)(e).forEach(n=>{let o=`${e}/${n}`,s=`${e}/${n.replace(".hbs","")}`;(0,R.createFileSync)(s),(0,R.writeFileSync)(s,xr(o,t)),(0,R.unlinkSync)(o)})};var Ye=e=>e.charAt(0).toUpperCase()+e.slice(1);var fe=e=>{switch(e){case"nextjs":return{path:"src/components",alias:"../src/components"};case"remix":return{path:"app/components",alias:"~/components"}}return{path:"src/pages",alias:"pages"}},He=e=>{switch(e){case"remix":return"./app";case"nextjs":case"react-scripts":case"vite":case"craco":case"parcel":case"unknown":default:return"./src"}};var ge=["list","create","edit","show"],wr=e=>{let t=y(),{path:r}=fe(t);return e.command("create-resource").allowExcessArguments(!0).description("Create a new resource files").option("-a, --actions [actions]","Only generate the specified actions. (ex: list,create,edit,show)","list,create,edit,show").option("-p, --path [path]","Path to generate the resource files",r).action(yr)},yr=async(e,t)=>{let{args:r}=t,n=e.actions;if(!r.length){let{name:o,selectedActions:s}=await Ke.default.prompt([{type:"input",name:"name",message:"Resource Name",validate:l=>l?!0:"Resource Name is required"},{type:"checkbox",name:"selectedActions",message:"Select Actions",choices:ge,default:e.actions.split(",")}]);r=[o],n=s.join(",")}r.forEach(o=>{let s=n?n.split(","):void 0,{path:l,alias:a}=fe(y()),h=(0,Je.plural)(o).toLowerCase(),c=(0,he.join)(process.cwd(),l,h);if((0,k.pathExistsSync)(c)){console.error(`Resource (${(0,he.join)(l,h)}) already exist! \u274C`);return}let m=Ye(o),v=qe(),M=`${__dirname}/../templates/resource`,d=Er();(0,k.copySync)(M,d);let p={resourceName:o,resource:m,actions:s||ge,uiFramework:v};Xe(d,p),s&&ge.forEach(T=>{s.includes(T)||(0,k.unlinkSync)(`${d}/${T}.tsx`)}),(0,k.mkdirSync)(e.path,{recursive:!0});let u=`${e.path}/${h}`,f={};(0,k.pathExistsSync)(u)&&(f={overwrite:!0}),(0,k.moveSync)(d,u,f),te.default.cleanupSync();let _=require.resolve(".bin/jscodeshift"),{stderr:E,stdout:U}=Ge.default.sync(_,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/resource.ts`,"--ignore-pattern=**/.cache/**","--ignore-pattern=**/node_modules/**","--ignore-pattern=**/build/**","--ignore-pattern=**/.next/**",`--__actions=${p.actions}`,`--__pathAlias=${a}`,`--__resourceFolderName=${h}`,`--__resource=${m}`,`--__resourceName=${o}`]);E&&console.log(E),console.log(`Resource (${u}) generated successfully! \u{1F389}`)})},Er=()=>(te.default.track(),te.default.mkdirSync("resource")),Ze=wr;var Qe=i(require("dotenv"));Qe.config();var Tr={development:/dev/i,production:/prod/i,test:/test|tst/i,"continuous-integration":/ci/i,"user-acceptance-testing":/uat/i,"system-integration-testing":/sit/i},Pr=()=>{let e=process.env.NODE_ENV;if(!e)return"development";let t="custom";for(let[r,n]of Object.entries(Tr))if(n.test(e)){t=r;break}return t},N={NODE_ENV:Pr(),REFINE_NO_TELEMETRY:process.env.REFINE_NO_TELEMETRY||"false",UPDATE_NOTIFIER_IS_DISABLED:process.env.UPDATE_NOTIFIER_IS_DISABLED||"false",UPDATE_NOTIFIER_CACHE_TTL:process.env.UPDATE_NOTIFIER_CACHE_TTL||1e3*60*60*24,REFINE_PROXY_DOMAIN:process.env.REFINE_PROXY_DOMAIN||"https://refine.dev",REFINE_PROXY_TARGET:process.env.REFINE_PROXY_TARGET||"http://localhost:3000",REFINE_PROXY_PORT:process.env.REFINE_PROXY_PORT||"7313",REFINE_PROXY_REWRITE_URL:process.env.REFINE_REWRITE_URL||"http://localhost:7313"};var et=i(require("express")),re=require("http-proxy-middleware"),Ir=e=>e.command("proxy").description("Manage proxy settings").action(Cr).option("-p, --port [port]","Port to serve the proxy server. You can also set this with the `REFINE_PROXY_PORT` environment variable.",N.REFINE_PROXY_PORT).option("-t, --target [target]","Target to proxy. You can also set this with the `REFINE_PROXY_TARGET` environment variable.",N.REFINE_PROXY_TARGET).option("-d, --domain [domain]","Domain to proxy. You can also set this with the `REFINE_PROXY_DOMAIN` environment variable.",N.REFINE_PROXY_DOMAIN).option("-r, --rewrite-url [rewrite URL]","Rewrite URL for redirects. You can also set this with the `REFINE_PROXY_REWRITE_URL` environment variable.",N.REFINE_PROXY_REWRITE_URL),Cr=async({port:e,target:t,domain:r,rewriteUrl:n})=>{let o=(0,et.default)(),l=new URL(t).protocol==="http:"?a=>{var h;a.headers["set-cookie"]&&((h=a.headers["set-cookie"])==null||h.forEach((c,m)=>{a&&a.headers&&a.headers["set-cookie"]&&(a.headers["set-cookie"][m]=c.replace("Secure;",""))}))}:void 0;o.use("/.refine",(0,re.createProxyMiddleware)({target:`${r}/.refine`,changeOrigin:!0,pathRewrite:{"^/.refine":""},logProvider:()=>({log:console.log,info:a=>{`${a}`.includes("Proxy rewrite rule created")||(`${a}`.includes("Proxy created")?console.log(`Proxying localhost:${e}/.refine to ${r}/.refine`):a&&console.log(a))},warn:console.warn,debug:console.debug,error:console.error})})),o.use("/.auth",(0,re.createProxyMiddleware)({target:`${r}/.auth`,changeOrigin:!0,cookieDomainRewrite:{"refine.dev":""},headers:{"auth-base-url-rewrite":`${n}/.auth`},pathRewrite:{"^/.auth":""},logProvider:()=>({log:console.log,info:a=>{`${a}`.includes("Proxy rewrite rule created")||(`${a}`.includes("Proxy created")?console.log(`Proxying localhost:${e}/.auth to ${r}/.auth`):a&&console.log(a))},warn:console.warn,debug:console.debug,error:console.error}),onProxyRes:l})),o.use("*",(0,re.createProxyMiddleware)({target:`${t}`,changeOrigin:!0,ws:!0,logProvider:()=>({log:console.log,info:a=>{`${a}`.includes("Proxy created")?console.log(`Proxying localhost:${e} to ${t}`):a&&console.log(a)},warn:console.warn,debug:console.debug,error:console.error})})),o.listen(Number(e))},tt=Ir;var b={["react-scripts"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>require.resolve(".bin/react-scripts")},["vite"]:{dev:["dev"],start:["preview"],build:["build"],getBin:()=>require.resolve(".bin/vite")},["nextjs"]:{dev:["dev"],start:["start"],build:["build"],getBin:()=>require.resolve(".bin/next")},["remix"]:{dev:["dev"],start:["build"],build:["build"],getBin:e=>{let t=e==="start"?"remix-serve":"remix";return require.resolve(`.bin/${t}`)}},["craco"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>require.resolve(".bin/craco")},["parcel"]:{dev:["start"],start:["start"],build:["build"],getBin:()=>require.resolve(".bin/parcel")},["unknown"]:{dev:[],start:[],build:[],getBin:()=>"unknown"}};var rt=i(require("execa")),A=async(e,t)=>{var n,o;if(e==="unknown"){let s=Object.values(B).filter(l=>l!=="unknown").join(", ");console.error(`We couldn't find executable for your project. Supported executables are ${s}.
Please use your own script directly. If you think this is an issue, please report it at: https://github.com/refinedev/refine/issues`);return}let r=(0,rt.default)(e,t,{stdio:"pipe",windowsHide:!1,env:{FORCE_COLOR:"true",...process.env}});return(n=r.stdout)==null||n.pipe(process.stdout),(o=r.stderr)==null||o.pipe(process.stderr),await r};var st=i(require("conf")),at=i(require("chalk"));var ot=e=>typeof btoa<"u"?btoa(e):Buffer.from(e).toString("base64");var vr="refine-update-notifier",j=new st.default({projectName:vr,defaults:{key:"",lastUpdated:0,packages:[]}}),q=async()=>{if(Sr())return;let e=await Nr();if(e!==null){if(e){nt();return}kr(),nt()}},kr=async()=>{let e=j.get("packages");e!=null&&e.length&&(await ee(e),console.log(`
`))},Nr=async()=>{let e=await Rr(),t=br();return e===null?null:!!(t||!e)},nt=async()=>{try{let e=await G();return j.set("packages",e),j.set("lastUpdated",Date.now()),j.set("key",await it()),e}catch{return j.set("packages",[]),j.set("lastUpdated",Date.now()),j.set("key",""),null}},br=()=>{let e=j.get("lastUpdated");if(!e)return!0;let r=Date.now()-e,n=Number(N.UPDATE_NOTIFIER_CACHE_TTL);return r>=n},Rr=async()=>{let e=j.get("key"),t=await it();return t===null?null:e===t},it=async()=>{let e=await W();if(!e)return console.error(at.default.red("Something went wrong when trying to get installed `refine` packages.")),null;let t=e.map(n=>`${n.name}@${n.version}`);return ot(t.toString())},Sr=()=>N.UPDATE_NOTIFIER_IS_DISABLED.toLocaleLowerCase()==="true";var X=e=>{let t=y(),r=b[t][e];return t==="remix"&&e==="start"&&(t="remix-serve"),`It runs: \`${t} ${r.join(" ")}\`. Also accepts all the arguments \`${t}\` accepts.`};var _r=e=>e.command("start").description(X("start")).allowUnknownOption(!0).argument("[args...]").action(Or),Or=async e=>{let t=y(),r=b[t].getBin("start"),o=[...b[t].start,...e];await q(),A(r,o)},xe=_r;var Dr=e=>e.command("dev").description(X("dev")).allowUnknownOption(!0).argument("[args...]").action(Ar),Ar=async e=>{let t=y(),r=b[t].getBin("dev"),o=[...b[t].dev,...e];await q(),A(r,o)},we=Dr;var jr=e=>e.command("build").description(X("build")).allowUnknownOption(!0).argument("[args...]").action($r),$r=async e=>{let t=y(),r=b[t].getBin("build"),o=[...b[t].build,...e];await q();try{await A(r,o)}catch{process.exit(1)}},ye=jr;var Ee=i(require("chalk"));var Ur=e=>e.command("run").description("Runs a defined package script. If no `command` is provided, it will list the available scripts").allowUnknownOption(!0).argument("[command] [args...]").action(Fr),Fr=async e=>{let[t,...r]=e,n=Z();if(!t){console.log(`Available via ${Ee.default.blue("`refine run`")}:
`);for(let[l,a]of Object.entries(n))console.log(`  ${l}`),console.log(`    ${Ee.default.dim(a)}`),console.log();return}if(!Object.keys(n).includes(t)){let l=`${process.cwd()}/node_modules/.bin/${t}`;A(l,r);return}let s=await D();A(s.name,["run",t,...r])},Te=Ur;var _t=i(require("react")),Ot=require("ink"),ve=i(require("path")),z=i(require("chalk")),K=i(require("inquirer")),Dt=i(require("inquirer-autocomplete-prompt")),$=require("fs-extra");var Ie=i(require("path"));var ft=i(require("path"));var Pe={};ir(Pe,{PackageManagerTypes:()=>We,ProjectTypes:()=>B,UIFrameworks:()=>ue,appendAfterImports:()=>mt,getFileContent:()=>oe,getImports:()=>Y,getNameChangeInImport:()=>lt});var Br=/import(?:(?:(?:[ \n\t]+([^ *\n\t\{\},]+)[ \n\t]*(?:,|[ \n\t]+))?([ \n\t]*\{(?:[ \n\t]*[^ \n\t"'\{\}]+[ \n\t]*,?)+\})?[ \n\t]*)|[ \n\t]*\*[ \n\t]*as[ \n\t]+([^ \n\t\{\}]+)[ \n\t]+)from[ \n\t]*(?:['"])([^'"\n]+)(?:['"])(?:;?)/g,Lr=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,Y=e=>{let t=e.matchAll(Br),r=[];for(let n of t){let[o,s,l,a,h]=n;r.push({statement:o,importPath:h,...s&&{defaultImport:s},...l&&{namedImports:l},...a&&{namespaceImport:a}})}return r==null?void 0:r.filter(Boolean)},lt=e=>{let t=e.matchAll(Lr),r=[];for(let n of t){let[o,s,l,a,h]=n;r.push({statement:o,fromName:s.trim(),toName:a.trim(),afterCharacter:h})}return r},zr=(e,t)=>{var s;let r=e.substring(0,e.indexOf(t.statement)),n=Y(r).pop();return n?r.substring(r.indexOf(n==null?void 0:n.statement)+((s=n==null?void 0:n.statement)==null?void 0:s.length)):r},Mr=(e,t)=>!!(t?zr(e,t):"").trim(),ct=["react","@refinedev/core","@refinedev/"],pt=e=>{var d;let t=e,r=Y(e),n=r.filter(p=>!p.statement.includes("import type ")),o=r.filter(p=>p.statement.includes("import type")),s=[],l=[];n.forEach(p=>{Mr(e,p)?s.push(p):l.push(p)});let a=t.indexOf((d=l==null?void 0:l[0])==null?void 0:d.statement);l.forEach(p=>{t=t.replace(p.statement,"")}),o.forEach(p=>{t=t.replace(p.statement,"")});let h=l.reduce((p,u)=>{let{importPath:f}=u;return p[f]?p[f].push(u):p[f]=[u],p},{}),v=[...Object.entries(h).map(([p,u])=>{let f=u.find(T=>T.defaultImport),_=u.find(T=>T.namespaceImport),E=u.filter(T=>T.namedImports).map(T=>(T.namedImports??"").replace(/{|}/g,"").trim().split(",").map(ie=>ie.trim()).filter(Boolean).join(", ")).join(", "),U="";return _&&(U+=_.statement+`
`),(f||E)&&(f&&E?U+=`import ${f.defaultImport}, { ${E} } from "${u[0].importPath}";
`:f?U+=`import ${f.defaultImport} from "${u[0].importPath}";
`:U+=`import { ${E} } from "${u[0].importPath}";
`),[p,U]})].sort(([p],[u])=>{let f=ct.findIndex(E=>p.includes(E)),_=ct.findIndex(E=>u.includes(E));return f===_?p.localeCompare(u):f===-1?1:_===-1?-1:f-_}).map(([,p])=>p).join(""),M=o.map(p=>p.statement).join(`
`);return t=t.substring(0,a)+v+M+t.substring(a),t};var mt=(e,t)=>{let r=Y(e),n=r[r.length-1],o=n?e.indexOf(n.statement):e.length-1;return e.slice(0,o+(n==null?void 0:n.statement.length))+`
`+t+`
`+e.slice(o+(n==null?void 0:n.statement.length))};var dt=require("fs-extra"),ut=require("path");function oe(e){if(this!=null&&this.absolutePackageDir)try{return(0,dt.readFileSync)((0,ut.join)(this.absolutePackageDir,e)).toString()}catch{return}}var gt=require("module"),Vr=gt.prototype.require,ht=(e,t)=>{gt.prototype.require=function(...r){return r[0]==="@refinedev/cli"?{...Pe,getFileContent:n=>oe.call({absolutePackageDir:t?e:ft.default.join(process.cwd(),e)},n)}:Vr.apply(this,r)}};var Ce=async(e,t)=>{try{return ht(e,t),require(Ie.default.join(t?e:Ie.default.join(process.cwd(),e),"refine.config.js"))}catch{return}};var ne=require("prettier"),xt=async e=>{try{let t=await(0,ne.resolveConfig)(process.cwd());return(0,ne.format)(e,{...t??{},parser:"typescript"})}catch{return e}};var g=i(require("react")),Pt=i(require("ink-markdown")),It=i(require("dedent")),x=require("ink");var I={SUCCESS:"SUCCESS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SOURCE_PATH_NOT_FOUND:"SOURCE_PATH_NOT_FOUND",TARGET_PATH_NOT_FOUND:"TARGET_PATH_NOT_FOUND",SOURCE_PATH_NOT_A_FILE:"SOURCE_PATH_NOT_A_FILE",TARGET_ALREADY_EXISTS:"TARGET_ALREADY_EXISTS"};var wt=i(require("chalk")),yt=i(require("cardinal")),Et=i(require("boxen")),Wr=e=>{let t=/^(?:\/\/\s?title:\s?)(.*?)\n/g,[r,n]=t.exec(e)??[];if(n){let o=n.trim(),s=e.replace(r,"");return{title:o,code:s}}return{code:e}},Tt=e=>{let{title:t,code:r}=Wr(e),n="";try{n=yt.default.highlight(r,{jsx:!0})}catch{n=r}return(0,Et.default)(n,{padding:1,margin:0,borderStyle:"round",borderColor:"gray",titleAlignment:"left",title:t?wt.default.bold(t):void 0})};var qr=({label:e,files:t,message:r="**`Warning:`** You should use the component where you want to use it."})=>{let n=t.filter(([,c])=>Object.values(I).filter(m=>m!==I.SUCCESS).includes(c)),o="success";switch(n.length){case 0:o="success";break;case t.length:o="error";break;default:o="warning";break}let s=()=>{switch(o){case"success":return g.default.createElement(x.Text,{color:"blueBright"},"Successfully swizzled ",g.default.createElement(x.Text,{bold:!0},e));case"warning":return g.default.createElement(x.Text,{color:"yellowBright"},"Swizzle completed with errors for"," ",g.default.createElement(x.Text,{bold:!0},e));case"error":return g.default.createElement(x.Text,{color:"redBright"},"Swizzle failed for ",g.default.createElement(x.Text,{bold:!0},e))}return null},l=c=>{let m=c==null?void 0:c.replace(process.cwd(),"");return m!=null&&m.startsWith("/")?m.slice(1):m!=null&&m.startsWith("./")?m.slice(2):m},a=()=>g.default.createElement(g.default.Fragment,null,g.default.createElement(x.Text,{dimColor:!0},"File",t.length>1?"s":""," created:"),t.map(([c,m],v)=>m===I.SUCCESS?g.default.createElement(x.Text,{key:v,dimColor:!0,color:"cyanBright"},` - ${l(c)}`):m===I.TARGET_ALREADY_EXISTS?g.default.createElement(x.Text,{key:v,dimColor:!0,color:"cyanBright"}," - ",g.default.createElement(x.Text,{color:"yellowBright",bold:!0},"[FILE_ALREADY_EXISTS]"," "),`${l(c)}`):m===I.SOURCE_PATH_NOT_A_FILE?g.default.createElement(x.Text,{key:v,dimColor:!0,color:"cyanBright"}," - ",g.default.createElement(x.Text,{color:"yellowBright",bold:!0},"[SOURCE NOT FOUND]"," "),`${l(c)}`):g.default.createElement(x.Text,{key:v,dimColor:!0,color:"cyanBright"}," - ",g.default.createElement(x.Text,{color:"yellowBright",bold:!0},"[",m,"]")))),h=()=>r&&o!=="error"?g.default.createElement(g.default.Fragment,null,g.default.createElement(Pt.default,{code:Tt},(0,It.default)(`
`+r)),g.default.createElement(x.Text,null,"\xA0")):null;return g.default.createElement(x.Box,{width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start"},g.default.createElement(x.Text,null,"\xA0"),s(),a(),g.default.createElement(x.Text,null,"\xA0"),h())},Ct=qr;var vt=e=>{let t=/(\/\/|\/\*)(\s?)swizzle-remove-start([\s\S]*?)(\/\/|\/\*)(\s?)swizzle-remove-end(\s*)(\*\/)?/g;return e.replace(t,"")};var At=i(require("boxen"));var kt=()=>{let e;try{e=y()}catch{e=void 0}return He(e)};var Nt=i(require("inquirer")),bt=i(require("chalk"));var Rt=async e=>{await Xr(e)?await Q(e):await Yr(e)},Xr=async e=>{let t=`This component requires following packages to be installed:
`.concat(e.map(n=>` - ${n}`).join(`
`)).concat(`
Do you want to install them?`),{installRequiredPackages:r}=await Nt.default.prompt([{type:"confirm",name:"installRequiredPackages",default:!0,message:t}]);return r},Yr=async e=>{let t=await D(),r=F[t.name].install.join(" "),n=e.join(" "),o=`${t.name} ${r} ${n}`;console.log(`
You can install them manually by running this command:`),console.log(bt.default.bold.blueBright(o))};var Hr=e=>e.command("swizzle").description(`Export a component or a function from ${z.default.bold("refine")} packages to customize it in your project`).action(Jr),St=e=>(t,r="")=>e.filter(o=>{var s;return o.label.toLowerCase().includes(r.toLowerCase())||((s=o.group)==null?void 0:s.toLowerCase().includes(r.toLowerCase()))}).flatMap((o,s,l)=>{var c;return[...(o==null?void 0:o.group)&&((c=l[s-1])==null?void 0:c.group)!==o.group&&o.group?[new K.default.Separator(`${z.default.bold(o.group)}`)]:[],{name:` ${o.label}`,value:o!=null&&o.value?o.value:o}]}),Jr=async e=>{var m,v,M;K.default.registerPrompt("autocomplete",Dt.default);let t=await _e(),r=[];if(await Promise.all(t.map(async d=>{let p=await Oe(d.path),u=r.findIndex(f=>f.name===d.name)===-1;p&&u&&r.push(d)})),r.length===0){console.log("No refine packages found with swizzle configuration.");return}console.log(`${(0,At.default)(`Found ${z.default.blueBright(r.length)} installed ${z.default.blueBright.bold("refine")} packages with swizzle configuration.`,{padding:1,textAlignment:"center",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"})}
`);let n=await Promise.all(r.map(async d=>{let p=await Ce(d.path,!0)??await Ce(d.path,!1)??{swizzle:{items:[]}};return{...d,config:p}})),{selectedPackage:o}=await K.default.prompt([{type:"autocomplete",pageSize:10,name:"selectedPackage",message:"Which package do you want to swizzle?",emptyText:"No packages found.",source:St(n.sort((d,p)=>{var u,f;return(((u=d.config)==null?void 0:u.group)??"").localeCompare(((f=p.config)==null?void 0:f.group)??"")}).map(d=>{var p,u;return{label:((p=d.config)==null?void 0:p.name)??d.name,value:d,group:(u=d.config)==null?void 0:u.group}}))}]),{swizzle:{items:s,transform:l}}=o.config,a;if(s.length===0){console.log(`No swizzle items found for ${z.default.bold(((m=o.config)==null?void 0:m.name)??o.name)}`);return}else s.length===1?a=s[0]:s.length>1&&(a=(await K.default.prompt([{type:"list",pageSize:10,name:"selectedComponent",message:"Which component do you want to swizzle?",emptyText:"No components found.",choices:St(s.sort((p,u)=>p.group.localeCompare(u.group)))({},"")}])).selectedComponent);if(!a){console.log(`No swizzle items selected for ${z.default.bold(((v=o.config)==null?void 0:v.name)??o.name)}`);return}let h=kt(),c=await Promise.all(a.files.map(async d=>{var p;try{let u=d.src?ve.default.join(o.path,d.src):void 0,f=d.dest?ve.default.join(process.cwd(),h,d.dest):void 0;if(!u)return console.log("No src path found for file",d),["",I.SOURCE_PATH_NOT_FOUND];if(!f)return console.log("No destination path found for file",d),["",I.TARGET_PATH_NOT_FOUND];if(!await(0,$.pathExists)(u))return[f,I.SOURCE_PATH_NOT_A_FILE];let E=await(0,$.readFile)(u,"utf-8");if(await(0,$.pathExists)(f))return[f,I.TARGET_ALREADY_EXISTS];await(0,$.ensureFile)(f);let T=vt(E),ae=((p=d.transform)==null?void 0:p.call(d,T))??T,ie=(l==null?void 0:l(ae,u,f))??ae,er=pt(ie),tr=await xt(er);return await(0,$.writeFile)(f,tr),[f,I.SUCCESS]}catch{return["",I.UNKNOWN_ERROR]}}));if(c.length>0){let{unmount:d}=(0,Ot.render)(_t.default.createElement(Ct,{label:a.label,files:c,message:a.message}));d(),(M=a==null?void 0:a.requiredPackages)!=null&&M.length&&await Rt(a.requiredPackages)}},jt=Hr;var Ft=require("commander");var H=i(require("inquirer")),ke=i(require("semver-diff")),se=i(require("chalk"));var $t=e=>{let t=e.filter((n,o)=>e.indexOf(n)!==o),r=new Set(t);return Array.from(r)};var Ut=async e=>{let t=Kr(e);if(!t){console.log("All `refine` packages are up to date. \u{1F389}");return}let r=Zr(t),n=await H.default.prompt([{type:"checkbox",name:"packages",message:"Choose packages to update",pageSize:r.pageSize,choices:r.choices,validate:Gr}]);return n.packages.length>0?n.packages:null},Gr=e=>{let r=e.map(o=>De(o)).map(o=>o.name),n=$t(r);return n.length>0?`You can't update the same package more than once. Please choice one.
 Duplicates: ${n.join(", ")}`:!0},Kr=e=>{if(e.length===0)return null;let t={patch:[],minor:[],major:[]};return e.forEach(r=>{let n=r.current,o=(0,ke.default)(n,r.wanted),s=(0,ke.default)(n,r.latest);if(o===s&&s){t[s].push({name:r.name,from:n,to:r.latest});return}o&&t[o].push({name:r.name,from:n,to:r.wanted}),s&&t[s].push({name:r.name,from:n,to:r.latest})}),t},Zr=e=>{let t=0,r=0;[e.patch,e.minor,e.major].forEach(c=>{c.forEach(m=>{m.name.length>t&&(t=m.name.length),m.from.length>r&&(r=m.from.length)})}),t+=2;let n=[],o="Package".padEnd(t),s="From".padEnd(r),a=`
   ${o} ${s}${"To".padStart(r)}`;n.push(new H.default.Separator(a)),e.patch.length>0&&(n.push(new H.default.Separator(se.default.reset.bold.blue(`
Patch Updates`))),e.patch.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})})),e.minor.length>0&&(n.push(new H.default.Separator(se.default.reset.bold.blue(`
Minor Updates`))),e.minor.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})})),e.major.length>0&&(n.push(new H.default.Separator(se.default.reset.bold.blue(`
Major Updates`))),e.major.forEach(c=>{n.push({name:`${c.name.padEnd(t)} ${c.from.padStart(r)} -> ${c.to}`,value:`${c.name}@${c.to}`})}));let h=n.length+6;return{choices:n,pageSize:h}};var Qr=e=>e.command("update").description("Interactively select and update all `refine` packages to selected version. To skip the interactive mode, use the `--all` option.").addOption(new Ft.Option("-t, --tag [tag]","Select version to update to.").choices(["next","latest"]).default("wanted","Version ranges in the `package.json` will be installed")).option("-a, --all","Update all `refine` packages to the selected `tag`. If `tag` is not provided, version ranges in the `package.json` will be installed. This option skips the interactive mode.",!1).option("-d, --dry-run","Get outdated packages installation command without automatic updating. If `tag` is not provided, version ranges in the `package.json` will be used.",!1).action(eo),eo=async e=>{let{tag:t,dryRun:r,all:n}=e,o=await V(G,"Checking for updates...");if(!(o!=null&&o.length)){console.log("All `refine` packages are up to date \u{1F389}");return}let s=n?to(t,o):await Ut(o);if(s){if(r){ro(s);return}oo(s)}},to=(e,t)=>e==="wanted"&&t.every(o=>o.current===o.wanted)?(console.log("All `refine` packages are up to date with the wanted version \u{1F389}"),null):t.map(n=>{let o=e==="wanted"?n.wanted:e;return`${n.name}@${o}`}),ro=async e=>{let t=await D(),r=F[t.name].install;console.log(`${t.name} ${r.join(" ")} ${e.join(" ")}`)},oo=e=>{console.log("Updating `refine` packages..."),console.log(e),Q(e)},Bt=Qr;var Lt=i(require("envinfo")),zt=i(require("ora")),no=e=>e.command("whoami").description("View the details of the development environment").action(so),so=async()=>{let e=(0,zt.default)("Loading environment details...").start(),t=await Lt.default.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Firefox","Safari"]},{showNotFound:!0,markdown:!0}),n=(await W()||[]).map(o=>` - ${o.name}: ${o.version}`).join(`
`);e.stop(),console.log(t),console.log("## Refine Packages:"),console.log(n)},Mt=no;var Vt=i(require("envinfo")),Wt=i(require("os")),ao=()=>{let e=Wt.default.type();return{Darwin:"macOS",Linux:"Linux",Windows_NT:"Windows"}[e]},qt=async()=>{let[e,t]=await Vt.default.helpers.getOSInfo();return{name:ao(),version:t}};var Xt=i(require("node-fetch")),io=async()=>{let e=await qt();return{nodeEnv:N.NODE_ENV,nodeVersion:process.version,os:e.name,osVersion:e.version,command:process.argv[2],packages:await W()||[],projectFramework:y()}},Yt=async()=>{if(N.REFINE_NO_TELEMETRY!=="true")try{let e=await io();await(0,Xt.default)("https://telemetry.refine.dev/cli",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}catch{}};var Jt=i(require("react"));var C=require("ink"),S=i(require("react")),co=()=>S.default.createElement(C.Box,{flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",borderColor:"greenBright",borderStyle:"double",padding:1},S.default.createElement(C.Text,{color:"greenBright"},"\u2705 Zero-trust security model"),S.default.createElement(C.Text,{color:"greenBright"},"\u2705 User/role management"),S.default.createElement(C.Text,{color:"greenBright"},"\u2705 Granular access control"),S.default.createElement(C.Text,{color:"greenBright"},"\u2705 Directory sync"),S.default.createElement(C.Text,{color:"greenBright"},"\u2705 VPN-less secure deployments"),S.default.createElement(C.Text,{color:"greenBright"},"\u2705 Direct connection to DBs"),S.default.createElement(C.Newline,null),S.default.createElement(C.Text,null,"Interested in any of the new backend features of refine? Join now and get early access -> https://s.refine.dev/meet-enterprise")),Ht=co;var Gt=require("ink"),lo=()=>(0,Gt.render)(Jt.default.createElement(Ht,null)),Kt=lo;var po="1.0.0",mo=()=>{let e=new Zt.Command;e.version(`@refinedev/cli@${po}`,"-v, --version","Output the current version.").description(Qt.default.textSync("refine",{font:"Isometric1",horizontalLayout:"full",verticalLayout:"full",whitespaceBreak:!0})).usage("<command> [options]").helpOption("-h, --help","Output usage information."),jt(e),Ze(e),Bt(e),we(e),ye(e),xe(e),Te(e),Ve(e),Mt(e),tt(e),e.hook("preAction",t=>{Kt()}),e.hook("postAction",t=>{let r=t.args[0];["run"].includes(r)||Yt()}),e.parse(process.argv),process.argv.slice(2).length||e.outputHelp()};mo();
//# sourceMappingURL=cli.js.map